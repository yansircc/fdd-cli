#!/bin/sh

# æ£€æŸ¥ package.json ç‰ˆæœ¬æ˜¯å¦è¶…è¿‡ npm å·²å‘å¸ƒç‰ˆæœ¬
local_ver=$(node -p "require('./package.json').version")
npm_ver=$(npm view fdd-cli version 2>/dev/null || echo "0.0.0")

# ä½¿ç”¨ node æ¯”è¾ƒ semverï¼ˆé¿å…ä¾èµ– npx semverï¼‰
is_greater=$(node -e "
const semver = (v) => v.split('.').map(Number);
const [a, b] = [semver('$local_ver'), semver('$npm_ver')];
const gt = a[0] > b[0] || (a[0] === b[0] && a[1] > b[1]) || (a[0] === b[0] && a[1] === b[1] && a[2] > b[2]);
process.exit(gt ? 0 : 1);
" && echo "yes" || echo "no")

if [ "$is_greater" = "no" ]; then
  echo ""
  echo "ğŸš« FDD: ç‰ˆæœ¬å·æœªæ›´æ–°ï¼"
  echo ""
  echo "   æœ¬åœ°ç‰ˆæœ¬: $local_ver"
  echo "   npm ç‰ˆæœ¬: $npm_ver"
  echo ""
  echo "   ä¿®å¤æ–¹æ³•ï¼š"
  echo "   1. æ›´æ–° package.json version"
  echo "   2. git add package.json"
  echo "   3. git commit --amend --no-edit"
  echo "   4. git push"
  echo ""
  exit 1
fi
